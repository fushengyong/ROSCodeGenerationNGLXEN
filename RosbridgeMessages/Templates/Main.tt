<#@ template debug="true" hostspecific="true"#>

<#@ include file="$(ProjectDir)\Templates\Helpers\FileLoader.ttinclude" once="true"#>
<#@ include file="$(ProjectDir)\Templates\Helpers\CodeGenerator.ttinclude" once="true" #>
<#@ include file="$(ProjectDir)\Templates\Helpers\ConfigFinder.ttinclude" once="true"#>
 
﻿<#@ assembly name="Microsoft.CSharp" #>
<#@ assembly name="System.Core" #>

<#@ import namespace="System" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ import namespace="System.Configuration" #> 
<#@ import namespace="System.IO" #>
<#@ import namespace="System.Linq" #>

<# 
    KeyValueConfigurationCollection appSettings = GetConfigFile(this.Host, this.Host.TemplateFile).AppSettings.Settings;
    string rosMessagesDirectoryPath = appSettings["RosMessagesDirectoryPath"].Value;
    string rosMessageTypeAttributeName = appSettings["RosMessageTypeAttributeName"].Value;
    string rosMessageTypeAttributeNamespace = appSettings["RosMessageTypeAttributeNamespace"].Value;
    string defaultNamespace = appSettings["RosDTONamespace"].Value;
    bool projectDefaultNamespaceAsPrefix = false;
    Boolean.TryParse(appSettings["UseProjectDefaultNamespaceAsPrefix"].Value, out projectDefaultNamespaceAsPrefix);

    HashSet<MsgFile> msgFileSet = new HashSet<MsgFile>();
    HashSet<SrvFile> srvFileSet = new HashSet<SrvFile>();

    LoadRosFiles(msgFileSet, srvFileSet, rosMessagesDirectoryPath);
    
    CodeGenerator generator = new CodeGenerator(this.Host, defaultNamespace, rosMessageTypeAttributeName, rosMessageTypeAttributeNamespace, projectDefaultNamespaceAsPrefix);

    generator.GenerateRosMessages(msgFileSet);
 #>